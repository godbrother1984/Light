server {
    listen 80;
    server_name localhost;
    root /usr/share/nginx/html;
    index main.html index.html index.htm;

    # กำหนด charset เป็น UTF-8 สำหรับภาษาไทย
    charset utf-8;

    # CORS Headers สำหรับ Firebase
    add_header Access-Control-Allow-Origin *;
    add_header Access-Control-Allow-Methods "GET, POST, OPTIONS, PUT, DELETE";
    add_header Access-Control-Allow-Headers "DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization";

    # กำหนด MIME types
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        add_header Access-Control-Allow-Origin *;
    }

    # Route สำหรับ HTML files
    location / {
        try_files $uri $uri.html $uri/ =404;
        
        # กำหนด headers สำหรับ HTML
        add_header X-Content-Type-Options nosniff;
        add_header X-Frame-Options DENY;
        add_header X-XSS-Protection "1; mode=block";
    }

    # Route เฉพาะสำหรับ main page
    location = / {
        try_files /main.html =404;
    }

    # Route สำหรับ template editor
    location /template-editor {
        try_files /template-editor.html =404;
    }

    # Route สำหรับ template manager  
    location /template-manager {
        try_files /template-manager.html =404;
    }

    # Route สำหรับ job details
    location /job-details {
        try_files /job-details.html =404;
    }

    # Route สำหรับ master data manager
    location /master-data-manager {
        try_files /master-data-manager.html =404;
    }

    # Route สำหรับ new job
    location /new-job {
        try_files /new-job.html =404;
    }

    # Route สำหรับ report finalizer
    location /report-finalizer {
        try_files /report-finalizer.html =404;
    }

    # Route สำหรับ branch manager
    location /branch-manager {
        try_files /branch-manager.html =404;
    }

    # กำหนด error pages
    error_page 404 /404.html;
    error_page 500 502 503 504 /50x.html;

    # Security headers
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    add_header Permissions-Policy "geolocation=(), microphone=(), camera=()" always;

    # Gzip compression
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types
        text/plain
        text/css
        text/xml
        text/javascript
        application/javascript
        application/xml+rss
        application/json;
}